Cahier des charges â€“ Backend NIASOTAC (RÃ©sumÃ© condensÃ©)
ğŸ¯ Objectif
Backend prÃªt production : sÃ©curisÃ©, scalable, testable, maintenable, documentÃ©. Chaque ticket inclut objectifs, fichiers, Ã©tapes, QA, estimation. Branches feature/ ou fix/, PR vers main, tests obligatoires, checklist QA.

ğŸ”’ PrioritÃ©s immÃ©diates (sÃ©curitÃ© + bugs)
ParamÃ¨tres sensibles

Supprimer fallback SECRET_KEY, lire depuis env, erreur si absent.

Remplacer CORS_ALLOW_ALL_ORIGINS par CORS_ALLOWED_ORIGINS (env, sÃ©parÃ© par virgule).

DEBUG contrÃ´lÃ© par env, forcÃ© False en prod.

Commande checks/startup_checks validant SECRET_KEY, ALLOWED_HOSTS, DATABASE_URL.

QA : tests unitaires lecture env/startup check.

Estimation : 2â€“4h.

IncohÃ©rences champs ProductStatus

Harmoniser noms (view_count, whatsapp_click_count).

Corriger partout (models, views, serializers, managers, admin).

Migration RenameField si nÃ©cessaire, sinon @property.

QA : tests unitaires increment_*, tests API retrieve/track_click.

Estimation : 6â€“10h.

Nettoyage requirements

Fusionner fichiers, supprimer doublons, pinner versions critiques.

Optionnel : pip-tools.

QA : install propre en CI.

Estimation : 1â€“2h.

âš™ï¸ PrioritÃ©s hautes (fiabilitÃ© & scalabilitÃ©)
Migration PostgreSQL

Ajouter dj-database-url/psycopg, utiliser DATABASE_URL.

CrÃ©er docker-compose.yml (web, postgres, redis, celery, beat).

Documenter migration SQLite â†’ Postgres.

QA : migrations OK, app fonctionnelle.

Estimation : 8â€“16h.

Durcissement Celery/Redis

Valider CELERY_BROKER_URL, RESULT_BACKEND via env.

Healthchecks workers docker-compose.

Documenter commandes workers/beat.

Optionnel : Flower monitoring.

QA : tÃ¢che test newsletter.

Estimation : 4â€“8h.

Logging & Monitoring (Sentry)

Ajouter sentry-sdk, init dans wsgi/asgi/settings.

Config logging structurÃ©.

Endpoint /healthz/.

QA : exception test remontÃ©e.

Estimation : 3â€“4h.

ğŸ“Š PrioritÃ©s moyennes (qualitÃ© & API)
Tests unitaires/intÃ©gration

Installer pytest-django, factory_boy, pytest-cov.

Tests : models (slug/sku, ProductImage, ProductStatus), services (PromotionService), views (ProductViewSet, Promotion, Newsletter).

Coverage â‰¥ 80%.

QA : tests CI.

Estimation : 3â€“5 jours.

Standardiser responses API

CrÃ©er helper api_response(success, data, message, error) ou mixin.

Refactor views.

QA : tests contractuels.

Estimation : 6â€“12h.

Robustesse promotions

Utiliser transaction.atomic() + select_for_update().

Tests concurrence simulÃ©e.

QA : pas dâ€™over-redemption.

Estimation : 4â€“8h.

Rate limiting/anti-spam

Ajouter django-ratelimit ou DRF middleware.

Appliquer sur endpoints sensibles.

QA : rÃ©ponses 429.

Estimation : 3â€“4h.

ğŸ› ï¸ PrioritÃ©s basses (maintenabilitÃ©/dev)
Linting/formatting/pre-commit

Config black, isort, ruff, hooks CI.

Estimation : 2â€“4h.

Type hints/docstrings

Ajouter annotations et docstrings aux fonctions critiques.

Estimation : 1â€“2 jours.

Documentation/README

Variables env, commandes docker-compose, migrations, superuser, tests, backup/restore.

Estimation : 2â€“4h.

Stockage mÃ©dias (S3)

Ajouter django-storages[boto3], config DEFAULT_FILE_STORAGE.

Documenter migration mÃ©dias.

Estimation : 4â€“8h.

CI GitHub Actions

Workflow lint/tests/security.

Estimation : 8â€“12h.

ğŸ“Œ Tickets spÃ©cifiques
Harmoniser ProductStatus â†’ migration + tests.

PromotionService race-condition â†’ atomic/select_for_update + tests.

Middleware API responses â†’ crÃ©er helper/mixin.

ğŸš€ CI/CD & DÃ©ploiement
Pipeline GitHub Actions, build docker image, staging identique prod.

ğŸ“š Runbooks utiles
Dev local : docker-compose up, migrations, collectstatic, superuser, pytest.

Backup Postgres : pg_dump / pg_restore.

âœ… Checklist livraison
SECRET_KEY env, DEBUG=False

CORS whitelist

Postgres OK

Celery workers/beat OK

Sentry configurÃ©

Tests coverage â‰¥ 80%

Linting/pre-commit OK

Docker-compose + docs

.env.example Ã  jour

Plan migration mÃ©dias

â±ï¸ Estimation globale
SÃ©curitÃ© immÃ©diate : 1â€“2j

Postgres/docker-compose : 1â€“2j

Celery/Sentry : 1â€“2j

Tests initiaux : 3â€“6j

CI/autres : 2â€“3j

Total : 9â€“16 jours.

ğŸ”® Recommandations long terme
MÃ©dias S3 + CDN

Secrets Manager

Monitoring Prometheus/Grafana

Security scans automatisÃ©s

Contract tests API